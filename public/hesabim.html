<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Hesabƒ±m | Livza Sposa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary-pink: #ff3366; --dark-blue: #2c3e50; }
        body { background-color: #f8f9fa; font-family: 'Poppins', sans-serif; }
        .account-header { background: white; padding: 40px 0; border-bottom: 1px solid #eee; margin-bottom: 30px; }
        .nav-pills .nav-link.active { background-color: var(--primary-pink); }
        .nav-pills .nav-link { color: var(--dark-blue); font-weight: 600; border-radius: 30px; padding: 10px 25px; }
        .data-card { background: white; border-radius: 15px; border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; }
        .badge-status { border-radius: 20px; padding: 5px 15px; font-size: 12px; }
    </style>
</head>
<body>

<div class="account-header text-center">
    <h1 style="font-family: 'Playfair Display';">Livza <span style="color: var(--primary-pink);">Sposa</span></h1>
    <p class="text-muted" id="user-welcome">Ho≈ü geldiniz</p>
    <div class="mt-3">
        <a href="index.html" class="btn btn-outline-secondary btn-sm rounded-pill">Maƒüazaya D√∂n</a>
    </div>
</div>

<div class="container">
    <ul class="nav nav-pills justify-content-center mb-5" id="pills-tab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#randevular" type="button">
                <i class="fas fa-calendar-alt me-2"></i>Randevularƒ±m
            </button>
        </li>
        <li class="nav-item ms-3">
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#siparisler" type="button" onclick="siparisleriYukle()">
                <i class="fas fa-shopping-bag me-2"></i>Sipari≈ülerim
            </button>
        </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="randevular">
            <div id="randevu-listesi" class="row g-3">
                </div>
        </div>

        <div class="tab-pane fade" id="siparisler">
            <div id="siparis-listesi" class="row g-3">
                </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    const user = JSON.parse(localStorage.getItem('user'));
    const userTel = user ? (user.telefon || user.telefon_no) : null;

    document.addEventListener("DOMContentLoaded", () => {
        if(!userTel) {
            window.location.href = "index.html";
            return;
        }
        document.getElementById('user-welcome').innerText = `Merhaba, ${user.ad || user.musteri_ad} ${user.soyad || ''}`;
        randevulariYukle();
    });

    async function randevulariYukle() {
        const res = await fetch(`/api/musteri/randevularim?tel=${userTel}`);
        const data = await res.json();
        const container = document.getElementById('randevu-listesi');
        
        container.innerHTML = data.length ? data.map(r => `
            <div class="col-md-6 col-lg-4">
                <div class="card data-card p-3">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h6 class="fw-bold mb-0 text-primary">${new Date(r.randevu_tarih).toLocaleDateString('tr-TR')}</h6>
                        <span class="badge ${r.onay_durumu==='Onaylandƒ±'?'bg-success':'bg-warning text-dark'} badge-status">${r.onay_durumu || 'Bekliyor'}</span>
                    </div>
                    <p class="mb-1"><i class="far fa-clock me-2"></i>Saat: <b>${r.saat}</b></p>
                    <p class="small text-muted mb-0"><i class="fas fa-info-circle me-2"></i>${r.notlar || 'Genel Prova'}</p>
                </div>
            </div>
        `).join('') : '<div class="text-center w-100 py-5"><p class="text-muted">Hen√ºz randevunuz bulunmuyor.</p></div>';
    }

    async function siparisleriYukle() {
        const res = await fetch(`/api/musteri/siparislerim?tel=${userTel}`);
        const data = await res.json();
        const container = document.getElementById('siparis-listesi');

        container.innerHTML = data.length ? data.map(s => `
            <div class="col-md-6">
                <div class="card data-card p-3 border-start border-4 border-success">
                    <div class="d-flex justify-content-between">
                        <div>
                            <span class="text-muted small">${new Date(s.satis_tarihi).toLocaleDateString('tr-TR')}</span>
                            <h6 class="fw-bold mt-1">${s.islem_turu === 'kiralama' ? 'üëó Kiralama' : 'üõçÔ∏è Satƒ±n Alma'}</h6>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-light text-dark border badge-status">${s.siparis_durumu || 'Hazƒ±rlanƒ±yor'}</span>
                            <h5 class="text-success fw-bold mt-1">${s.toplam_tutar} ‚Ç∫</h5>
                        </div>
                    </div>
                </div>
            </div>
        `).join('') : '<div class="text-center w-100 py-5"><p class="text-muted">Hen√ºz sipari≈üiniz bulunmuyor.</p></div>';
    }
</script>

</body>
</html>